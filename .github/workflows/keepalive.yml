name: Keep Strapi Awake

on:
  schedule:
    - cron: "*/12 * * * *" 
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    steps:
      - name: Ping Strapi (warm + verify)
        env:
          STRAPI_URL: ${{ secrets.STRAPI_URL }}
        run: |
          echo "Pinging Strapi..."
          # Warm-up request
          code1=$(curl -sS -o /dev/null -w "%{http_code}" "$STRAPI_URL" || echo 599)
          # brief pause, then verify it's warm
          sleep 7
          code2=$(curl -sS -o /dev/null -w "%{http_code}" "$STRAPI_URL" || echo 599)
          echo "HTTP codes: $code1, $code2"
          # succeed if either call is < 500 (200/301/404 are all fine for wake-up)
          if [ "${code1:-999}" -lt 500 ] || [ "${code2:-999}" -lt 500 ]; then
            exit 0
          else
            exit 1
          fi